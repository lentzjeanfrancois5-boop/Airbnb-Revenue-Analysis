-- FILE: 1_Airbnb_Data_Prep_BASIC_SQL.sql
-- PURPOSE: Basic calculation of average price, listing count, and quality score by neighborhood.

SELECT
    neighbourhood_cleansed AS Neighbourhood,

    -- 1. Calculate the Average Daily Rate (ADR)
    ROUND(
        AVG(
            -- Clean and convert price column to a number
            CAST(REPLACE(REPLACE(price, '$', ''), ',', '') AS NUMERIC)
        ), 
        2
    ) AS Average_Daily_Rate,
    
    -- 2. Calculate the Total Number of Listings (Competition/Volume)
    COUNT(listing_id) AS Total_Listings_Count,
    
    -- 3. Calculate the Average Review Score (Quality Metric)
    ROUND(
        AVG(
            CAST(review_scores_rating AS NUMERIC)
        ), 
        2
    ) AS Average_Quality_Score
    
FROM
    raw_listings_table
WHERE
    -- Data Quality Filter: Exclude invalid prices and missing review scores
    CAST(REPLACE(REPLACE(price, '$', ''), ',', '') AS NUMERIC) > 5 
    AND review_scores_rating IS NOT NULL

GROUP BY
    neighbourhood_cleansed
    
HAVING
    COUNT(listing_id) >= 10 -- Ensures statistical relevance (only neighborhoods with at least 10 listings)

ORDER BY
    Average_Daily_Rate DESC;
